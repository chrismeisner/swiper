<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swiper with Button Selection</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <style>
	/* Global styles */
	body {
	  margin: 0;
	  padding: 0;
	  font-family: Arial, sans-serif;
	  background-color: #f4f4f4;
	}

	/* Center the main content */
	.main-container {
	  max-width: 900px;
	  margin: 0 auto;
	  padding: 20px;
	  background-color: #fff;
	  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	}

	/* Ensure the container is responsive */
	.main-container img {
	  max-width: 100%;
	  height: auto;
	}

	/* Swiper styling */
	.swiper {
	  width: 80%;
	  margin: 0 auto 20px auto;
	  display: none; /* Initially hide the Swiper container */
	}

	.swiper-slide {
	  background-color: #ddd;
	  display: flex;
	  flex-direction: column;
	  justify-content: center;
	  align-items: center;
	  font-size: 24px;
	  font-weight: bold;
	  padding: 20px;
	  box-sizing: border-box;
	}

	/* Button container */
	.button-container {
	  display: flex;
	  gap: 10px;
	  margin-top: 20px;
	}

	/* Style for the buttons */
	.button {
	  padding: 10px 20px;
	  background-color: #007BFF;
	  color: white;
	  border: none;
	  cursor: pointer;
	  font-size: 16px;
	}

	.button.selected {
	  background-color: #0056b3;
	}

	.button:hover {
	  background-color: #0056b3;
	}

	/* Style for swiper pagination */
	.swiper-pagination {
	  position: relative;
	  margin-top: 40px; /* Move pagination down by 40px */
	}

	/* Hide navigation buttons */
	.swiper-button-next, 
	.swiper-button-prev {
	  display: none;
	}

	/* Loader styling */
	#loading-indicator {
	  text-align: center;
	  font-size: 18px;
	  color: #333;
	  margin: 20px;
	}

	/* Media queries for better mobile responsiveness */
	@media (max-width: 900px) {
	  .main-container {
		padding: 10px;
	  }
	}

	@media (max-width: 600px) {
	  .swiper-slide {
		font-size: 18px;
	  }

	  .button {
		font-size: 14px;
		padding: 8px 16px;
	  }
	}
  </style>
</head>
<body>

  <div class="main-container">
	<h1>Welcome to Our Responsive Site</h1>
	<p>This section of the website has a maximum width of 900px and scales down nicely for mobile devices.</p>

	<!-- Loader while fetching -->
	<div id="loading-indicator">Loading...</div>

	<!-- Swiper Container -->
	<div class="swiper">
	  <div class="swiper-wrapper">
		<!-- Slides will be generated dynamically here -->
	  </div>

	  <div class="swiper-pagination"></div>
	</div>

	<p id="dynamic-content">Feel free to explore this demo and resize the window to see how the content adapts to different screen sizes.</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  <script>
	// Define swiper globally so it can be used in multiple places
	let swiper;

	// Function to update button styles (same as before)
	function updateButtonStyles() {
	  const currentSlide = swiper.slides[swiper.activeIndex];  // Use activeIndex to get the current slide
	  const buttons = currentSlide.querySelectorAll('.button');

	  // Reset button styles
	  buttons.forEach(button => button.classList.remove('selected'));

	  // Highlight the selected button
	  const selectedButton = currentSlide.dataset.selected;
	  if (selectedButton) {
		const selected = currentSlide.querySelector(`button[data-button="${selectedButton}"]`);
		if (selected) selected.classList.add('selected');
	  }

	  console.log('üîÑ Button styles updated on slide change.');
	}

	// Fetch data from server and dynamically generate slides
	async function fetchPropositions() {
	  try {
		console.log('üì° Fetching propositions from server...');

		// Show the loading indicator
		document.getElementById('loading-indicator').style.display = 'block';

		const response = await fetch('/api/props');
		const propositions = await response.json();

		console.log('‚úÖ Propositions fetched successfully:', propositions);

		const swiperWrapper = document.querySelector('.swiper-wrapper');
		swiperWrapper.innerHTML = '';  // Clear any previous slides

		// Create slides dynamically based on the fetched propositions
		propositions.forEach((item, index) => {
		  console.log(`üî® Creating slide for proposition: ${item.proposition} (Index: ${index})`);

		  const slide = document.createElement('div');
		  slide.classList.add('swiper-slide');
		  slide.setAttribute('data-selected', '');

		  // Set the image URL to the one from Airtable, and apply the 'cover' style for object-fit
		  slide.innerHTML = `
			<div style="width: 600px; height: 400px; background-image: url('${item.imageUrl}'); background-size: cover; background-position: center;"></div>
			<div>${item.proposition}</div>
			<div class="button-container">
			  <button class="button" data-slide="${index}" data-button="left">Left Button</button>
			  <button class="button" data-slide="${index}" data-button="right">Right Button</button>
			</div>
		  `;

		  swiperWrapper.appendChild(slide);
		});

		console.log('üßπ All slides generated and added to the Swiper wrapper.');

		// Hide the loading indicator and show the swiper
		document.getElementById('loading-indicator').style.display = 'none';
		document.querySelector('.swiper').style.display = 'block';

		// Initialize Swiper after adding slides
		swiper = new Swiper('.swiper', {
		  slidesPerView: 1,
		  spaceBetween: 10,
		  effect: 'cards',
		  cardsEffect: {
			slideShadows: true,
		  },
		  pagination: {
			el: '.swiper-pagination',
			clickable: true, // Enable pagination to be clickable
		  },
		  keyboard: {
			enabled: true,
			onlyInViewport: true,
		  },
		  loop: false,
		  on: {
			slideChangeTransitionEnd: function () {
			  updateButtonStyles();
			},
		  },
		});

		console.log('üöÄ Swiper initialized successfully.');

		// Attach event listener to buttons for selection
		document.querySelector('.swiper').addEventListener('click', function(event) {
		  if (event.target.classList.contains('button')) {
			console.log('üñ±Ô∏è Button clicked!', event.target);

			const currentSlide = swiper.slides[swiper.activeIndex];
			const selectedButton = event.target.dataset.button;

			// Store selection in data-selected attribute
			currentSlide.dataset.selected = selectedButton;

			// Update button styles after selection
			updateButtonStyles();

			console.log(`üëç Button "${selectedButton}" selected for slide ${swiper.activeIndex}.`);
		  }
		});
	  } catch (error) {
		console.error('‚ùå Error fetching propositions:', error);
		document.getElementById('loading-indicator').textContent = '‚ùå Failed to load hero cards.';
	  }
	}

	// Call fetchPropositions on page load
	document.addEventListener('DOMContentLoaded', () => {
	  console.log('üåê Document loaded. Fetching propositions...');
	  fetchPropositions();
	});
  </script>
</body>
</html>
